<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<script src="WebDirt/SampleBank.js"></script>
<script src="WebDirt/WebDirt.js"></script>
<script src="WebDirt/Graph.js"></script>
<script>

function setup() {
  var host = location.hostname;
  estuaryWebSocket = new WebSocket("ws://" + host + ":9162");
  estuaryWebSocket.onopen = function () { console.log("estuaryWebSocket opened!"); };
  estuaryWebSocket.onerror = function () { console.log("estuaryWebSocket error"); };
  estuaryWebSocket.onmessage = function (m) {
    var score = JSON.parse(m.data);
    webDirt.playScore(score);
    var div = document.getElementById('renderResults');
    if(div.firstChild)div.removeChild(div.firstChild);
    var text = document.createTextNode(JSON.stringify(score));
    div.appendChild(text);
  }
  webDirt = new WebDirt("WebDirt/sampleMap.json","Dirt/samples",0.5);
  webDirt.subscribeToTidalSocket("ws://" + host + ":9163",true);
}

function hush() {
  estuaryWebSocket.send(JSON.stringify({ "hush": "hush" }));
}

function cps() {
  var value = document.getElementById('cps').value;
  if(value != null && value != "") estuaryWebSocket.send("{\"cps\":" + value + "}");
}

function send(id) {
  var value = document.getElementById(id).value;
  if(value != null && value != "") {
    var msg = "{\"" + id + "\":" + JSON.stringify(value) + "}";
    console.log(msg);
    estuaryWebSocket.send(msg);
  }
}

function render() {
  var pattern = document.getElementById('renderPattern').value;
  if(pattern == null || pattern == "") return;
  var cps = document.getElementById('renderCps').value;
  if(cps == null || cps == "") cps = "1.0";
  var cycles = document.getElementById('renderCycles').value;
  if(cycles == null || cycles == "") cycles = "1";
  cps = Number(cps);
  cycles = Number(cycles);
  var msg;
  msg = '{"render":' + JSON.stringify(pattern) + ',"cps":' + cps + ',"cycles":' + cycles + '}';
  console.log(msg);
  estuaryWebSocket.send(msg);
}

</script>
</head>

<body onload="setup()">
<h2>simple client for estuaryWebSocket</hr><br/>
<div><button onclick="hush()">hush</button></div>
<div><button onclick="cps()">cps</button><textarea id="cps" rows="1"></textarea></div>
<div><button onclick="send('d1')">d1</button><textarea id="d1" rows="3"></textarea></div>
<div><button onclick="send('d2')">d2</button><textarea id="d2" rows="3"></textarea></div>
<div><button onclick="send('d3')">d3</button><textarea id="d3" rows="3"></textarea></div>
<div><button onclick="send('d4')">d4</button><textarea id="d4" rows="3"></textarea></div>
<div><button onclick="send('d5')">d5</button><textarea id="d5" rows="3"></textarea></div>
<div><button onclick="send('d6')">d6</button><textarea id="d6" rows="3"></textarea></div>
<div><button onclick="send('d7')">d7</button><textarea id="d7" rows="3"></textarea></div>
<div><button onclick="send('d8')">d8</button><textarea id="d8" rows="3"></textarea></div>
<div><button onclick="send('d9')">d9</button><textarea id="d9" rows="3"></textarea></div>
<div><button onclick="send('info')">info</button><textarea id="info" rows="5"></textarea></div>
<div>
  <button onclick="render()">render</button>
  <textarea id="renderPattern" rows="5"></textarea>
  <textarea id="renderCps" rows="1"></textarea>
  <textarea id="renderCycles" rows="1"></textarea>
</div>
<div><h4>Render Results:</h4>
  <div id="renderResults"></div>
</div>
</body>

</html>
